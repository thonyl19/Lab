@using System.Dynamic
@{
	bool isSingleModel = (bool)ViewData["SingleModel"];
	dynamic data = new ExpandoObject();
    if (true)
	{
		Layout = "~/Views/Shared/_LayoutSingle.cshtml";
	}
    GTI_Test GTest = new GTI_Test(Html, ViewContext.HttpContext);
}
@eBundle.QRender_CSS()
@eBundle.QRender_JS()

<div id="app">
    <el-checkbox v-model="del_mode">del_mode</el-checkbox>
    <el-checkbox v-model="readonly">readonly</el-checkbox>
    <el-checkbox v-model="set_mode">set_mode</el-checkbox>

    <gt-hr content="基本用法" :active="active">
        <gti-rwd-layout v-model="tableData" rwd_width="1000" :i18n="i18n" rwd="false" :del_mode="del_mode"
                        :readonly="readonly" :set_mode="set_mode"></gti-rwd-layout>
    </gt-hr>
    <gt-hr content="自定排序" :active="active">
        <gti-rwd-layout v-model="tableData" rwd_width="1000" :i18n="i18n" rwd="false" :del_mode="del_mode"
                        :readonly="readonly" :set_mode="set_mode" :order="order"></gti-rwd-layout>
    </gt-hr>
    <gt-hr content="進階用法-自定義表格" :active="active">
        <gti-rwd-layout v-model="tableData">
            <el-table :data="tableData">
                <el-table-column label='date' prop="date">
                    <template slot-scope="scope">
                        <input v-model="scope.row.date" />
                    </template>
                </el-table-column>
                <el-table-column label='name' prop="name"></el-table-column>
                <el-table-column label='address' prop="address"></el-table-column>
            </el-table>
        </gti-rwd-layout>
    </gt-hr>
    <gt-hr content="進階用法-自定義表單" :active="active">
        <gti-rwd-layout v-model="tableData" :pda_mode="isPDA">
            <template slot="form">
                {{tableData}}
            </template>
        </gti-rwd-layout>
    </gt-hr>
</div>
<script>
    $(() => {
        //原型
        var layout = {
            mixins: [Vue.prototype.$UT.Mixins.v_model()],
            template: `
        <div class="gti-rwd-layout">
            <div class="dyn-setting">
                <A>
                    <i class="fa fa-gear fa-2x" @@click="isShowSet=!isShowSet"></i>
                </A>
                <transition name="zoom">
                    <div v-show="isShowSet" class="menu">
                        <el-checkbox v-model="c_RWD">RWD</el-checkbox> </br>
                        <el-radio-group v-model="c_isPDA" size="small">
                            <el-radio-button label="Table"></el-radio-button>
                            <el-radio-button label="Form"></el-radio-button>
                          </el-radio-group>
                    </div>
                </transition>
            </div>
            <slot name="form" v-if="isPDA">
                <div class="panel">
                    <transition-group name="zoom">
                        <div class="panel-body form-horizontal gt-form" v-for="(item,idx) in c_val" :key="idx">
                            <A class="del-icon" v-if="del_mode">
                                <i class="fa fa-trash fa-2x" @@click="Del(idx)"></i>
                            </A>    
                            <gt-form-col v-for="(item,key) in c_val[idx]" :key="key" :label='f_label(key)' v-model="item" :readonly="readonly" ></gt-form-col>
                            <div class="clearfix"></div>
                            <hr/>
                        </div>
                    </transition-group>
                </div>
            </slot>
            <slot v-else>
                <el-table :data="c_val">
                    <el-table-column label="操作" width="60" v-if="del_mode">
                        <template slot-scope="scope">
                            <transition name="zoom">
                                <el-button size="small" circle
                                            type="danger"
                                            icon="el-icon-delete"
                                            @@click="Del(scope.$index)"></el-button>
                            </transition>
                        </template>
                    </el-table-column>
                    <el-table-column v-for="(item,key) in c_val[0]" :key="key" :label='f_label(key)' :prop="key"></el-table-column>
                </el-table>
            </slot>
        </div>
					`,
            data() {
                return {
                    windowWidth:0,
                    isPDA: true,
                    RWD: false,
                    isShowSet: true,
                }
            },
            props: {
                pda_mode: {
                    type: Boolean,
                    default() { return true }
                },
                rwd_width: {
                    type: [Number,String],
                    default() { return 900 }
                },
                i18n: {
                    type: Object,
                    default() { return null }
                },
                rwd: {
                    type: Boolean,
                    default() { return true }
                },
                del_mode: {
                    type: Boolean,
                    default() { return false }
                },
                readonly: {
                    type: Boolean,
                    default() { return true }
                },
            },
            mounted() {
                this.isPDA = this.pda_mode;
                this.c_RWD = eval(this.rwd);
                    
            },
            beforeDestroy() {
                window.removeEventListener('resize', this.handleResize);
            },
            computed: {
                c_isPDA: {
                    get() { return this.isPDA ?'Form': 'Table' },
                    set(val) {
                        this.isPDA = val =='Form';
                        this.$emit('update:pda_mode', val == 'Form');
                    }
                },
                c_RWD: {
                    get() { return this.RWD },
                    set(val) {
                        this.RWD = val;
                        if (val) {
                            window.addEventListener('resize', this.handleResize);
                            this.handleResize();
                        } else {
                            window.removeEventListener('resize', this.handleResize);
                        }
                        this.$emit('update:rwd', val);

                    }
                }
            },
            methods: {
                Del(idx) {
                    this.$confirm('請確認是否刪除?', '提示', {
                        confirmButtonText: '確定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        this.c_val.splice(idx, 1);
                        _self.$message({
                            type: 'success',
                            message: '移除成功!'
                        });
                    }).catch(() => {
                        _self.$message({
                            type: 'info',
                            message: '已取消'
                        });
                    });
                },
                f_label(key) {
                    if (this['i18n'] == null) return key;
                    return this.i18n[key] || key;
                },
                handleResize() {
                    this.windowWidth = window.innerWidth;
                    this.isPDA = this.windowWidth < this.rwd_width;
                },
            }
        };
        new Vue({
            el: '#app',
            //components: { 'gti-rwd-layout': layout }, 
            data() {
                return {
                    set_mode: true,
                    del_mode: true,
                    readonly: false,
                    active: true,
                    tableData: [{ "id": 1, "date": "2016-05-02", "name": "王小虎", "address": "上海市普陀区金沙江路 1518 弄" }, { "id": 2, "date": "2016-05-04", "name": "王小虎", "address": "上海市普陀区金沙江路 1517 弄" }, { "id": 3, "date": "2016-05-01", "name": "王小虎", "address": "上海市普陀区金沙江路 1519 弄", "children": [{ "id": 31, "date": "2016-05-01", "name": "王小虎", "address": "上海市普陀区金沙江路 1519 弄" }, { "id": 32, "date": "2016-05-01", "name": "王小虎", "address": "上海市普陀区金沙江路 1519 弄" }] }, { "id": 4, "date": "2016-05-03", "name": "王小虎", "address": "上海市普陀区金沙江路 1516 弄" }],
                    i18n: {
                        name: '姓名'
                    },
                    order: ['date','id']
                }
            },
        })
    });
</script>
